<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8">
    <title>PAID</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container py-4">
        <h1 class="mb-3">ข้อมูล</h1>
        <div class="d-flex justify-content-between mb-3">
            <div>
                <a href="{{ url_for('import_excel') }}" class="btn btn-success me-2">นำเข้า Excel</a>
                <a href="{{ url_for('import_paid') }}" class="btn btn-primary">นำเข้า Paid</a>
            </div>
            <form method="get" class="d-flex align-items-center gap-2">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="paid_filter" id="filterAll" value="ALL" onchange="this.form.submit()" {{ 'checked' if paid_filter=='ALL' else '' }}>
                    <label class="form-check-label" for="filterAll">All</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="paid_filter" id="filterPaid" value="PAID" onchange="this.form.submit()" {{ 'checked' if paid_filter=='PAID' else '' }}>
                    <label class="form-check-label" for="filterPaid">PAID</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="paid_filter" id="filterUnpaid" value="UNPAID" onchange="this.form.submit()" {{ 'checked' if paid_filter=='UNPAID' else '' }}>
                    <label class="form-check-label" for="filterUnpaid">UNPAID</label>
                </div>
                <input type="hidden" name="per_page" value="{{ per_page }}">
                <input type="hidden" name="search" value="{{ search }}">
                <input type="hidden" name="page" value="1">
            </form>
        </div>

        <!-- แถบควบคุมจำนวนต่อหน้า -->
        <form class="row g-2 mb-3 align-items-center" method="get">
            <div class="col-auto">
                <label class="col-form-label">แสดงต่อหน้า</label>
            </div>
            <div class="col-auto">
                <select name="per_page" class="form-select" onchange="this.form.submit()">
                    {% for n in [10,20,50,100] %}
                    <option value="{{ n }}" {{ 'selected' if per_page==n else '' }}>{{ n }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto ms-auto position-relative">
                <input type="text" id="searchInput" name="search" value="{{ search }}" class="form-control pe-5" placeholder="ค้นหา">
                <button type="button" id="clearSearch" class="btn-close position-absolute end-0 top-50 translate-middle-y me-2" aria-label="Clear" style="display: none;"></button>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-secondary">ค้นหา</button>
            </div>
            <!-- คง page=1 เสมอเมื่อเปลี่ยน per_page หรือค้นหาใหม่ -->
            <input type="hidden" name="page" value="1">
            <input type="hidden" name="paid_filter" value="{{ paid_filter }}">
        </form>

        <div class="card shadow-sm">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>ลำดับ</th>
                            <th>วันที่</th>
                            <th>เลขเคลม</th>
                            <th>ใบแจ้งหนี้</th>
                            <th>ใบแจ้งหนี้อ้างอิง</th>
                            <th>ครั้งที่</th>
                            <th>เสนอ</th>
                            <th>อนุมัติ</th>
                            <th>สถานะตรวจ</th>
                            <th>สถานะคีย์</th>
                            <th>สถานะจ่าย</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in rows %}
                        <tr>
                            <td>{{ loop.index + (page - 1) * per_page }}</td>
                            <td>{{ r.day }}</td>
                            <td>{{ r.claim }}</td>
                            <td>{{ r.invoice }}</td>
                            <td>{{ r.invoiceref }}</td>
                            <td>{{ r.no }}</td>
                            <td>{{ r.offer }}</td>
                            <td>{{ r.approve }}</td>
                            <td>{{ r.status }}</td>
                            <td>{{ r.statuskey }}</td>
                            <td>{% if r.paid_status == 'PAID' %}<span class="text-success fw-bold">PAID</span>{% endif %}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ข้อความสรุป + ปุ่มเลขหน้า -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mt-3 gap-2">
            <div class="text-muted small">
                {{ pagination.info }} <!-- ใช้ display_msg จาก Pagination -->
            </div>
            <nav aria-label="Page navigation">
                {{ pagination.links }}
            </nav>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearch');

            function toggleClear() {
                clearBtn.style.display = searchInput.value ? 'block' : 'none';
            }

            clearBtn.addEventListener('click', function () {
                searchInput.value = '';
                toggleClear();
                searchInput.focus();
            });

            searchInput.addEventListener('input', toggleClear);

            toggleClear();
        });
    </script>
</body>
</html>
